<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2XSTFHH377"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-2XSTFHH377');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>College Football - Merit Based Standings</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <h1>College Football - Merit Based Standings</h1>
            <nav class="nav">
                    <div class="dropdown">
                        <a href="#" class="nav-item active">Standings ▼</a>
                        <div class="dropdown-content">
                            <a href="#current-standings" class="dropdown-item">Current Standings</a>
                            <a href="#previous-standings" class="dropdown-item">Previous Standings</a>
                        </div>
                    </div>
                    <a href="#about" class="nav-item">About the Standings</a>
                    <a href="#total-points" class="nav-item">Total Points</a>
                    <a href="#2024-comparison" class="nav-item">2024 Standing Comparison</a>
                    <a href="#all-games" class="nav-item">All Game Data</a>
                    <!--
                    <div class="dropdown">
                        <a href="#" class="nav-item">Week Details ▼</a>
                        <div class="dropdown-content">
                            <a href="#" class="dropdown-item" onclick="showPage('week-1')">Week 1</a>
                            <a href="#" class="dropdown-item" onclick="showPage('week-2')">Week 2</a>
                            <a href="#" class="dropdown-item" onclick="showPage('week-3')">Week 3</a>
                            <a href="#" class="dropdown-item" onclick="showPage('week-4')">Week 4</a>
                            <a href="#" class="dropdown-item" onclick="showPage('week-5')">Week 5</a>
                            <a href="#" class="dropdown-item" onclick="showPage('week-6')">Week 6</a>
                            <a href="#" class="dropdown-item" onclick="showPage('week-7')">Week 7</a>
                            <a href="#" class="dropdown-item" onclick="showPage('week-8')">Week 8</a>
                            <a href="#" class="dropdown-item" onclick="showPage('week-9')">Week 9</a>
                            <a href="#" class="dropdown-item" onclick="showPage('week-10')">Week 10</a>
                            <a href="#" class="dropdown-item" onclick="showPage('week-11')">Week 11</a>
                            <a href="#" class="dropdown-item" onclick="showPage('week-12')">Week 12</a>
                            <a href="#" class="dropdown-item" onclick="showPage('week-13')">Week 13</a>
                            <a href="#" class="dropdown-item" onclick="showPage('week-14')">Week 14</a>
                            <a href="#" class="dropdown-item" onclick="showPage('week-15')">Week 15</a>
                        </div>
                    </div>
                -->
                </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Current Standings Page -->
        <div id="current-standings" class="page active">
            <div class="container">
                <h2>Current Standings (Updated 9/21)</h2>
                <p>The latest merit-based rankings showing where each team stands in the current season.</p>
                <p>Select the team to view their season's resume.</p>
                <div id="currentMessageArea"></div>
                <div id="currentTableSection">
                    <div id="currentTableInfo" class="table-info"></div>
                    <div id="currentTableContainer"></div>
                </div>
            </div>
        </div>

        
        <!-- Previous Standings Page -->
        <div id="previous-standings" class="page">
            <div class="container">
                <h2>Previous Standings</h2>
                <p>The previous merit-based rankings from an earlier period in the season.</p>
                <div id="previousMessageArea"></div>
                <div id="previousTableSection">
                    <div id="previousTableInfo" class="table-info"></div>
                    <div id="previousTableContainer"></div>
                </div>
            </div>
        </div>

        <!-- About the Standings Page -->
        <div id="about" class="page">
            <div class="container">
                <h2>About the Standings</h2>
                <p>Welcome to the College Football Merit Based Standings system. This standings methodology aims for transparency and simplicity. It evaluates teams based on what was accomplished on the field, not hidden human biases in traditional polls or the black box of computer rankings alone.</p>
                <p>Like soccer, who give teams 3 points for a win, 1 for a tie, and 0 for a loss, we wondered if the same could apply to football. The challenge is not every team plays one another, so you must account for strength of schedule. We propose a method to do just that.</p>
                
                <h3>How It Works</h3>
                <p>Every game can be worth up to 10 points for a total of 120 points possible in the season</p>
                <p>Our merit-based system considers 4 factors:</p>
                
                <ul>
                    <li><strong>Did you win?</strong> If you lose your game that week you get no points, if you won you get <strong>4</strong> points </li>
                    <li><strong>How did you win?</strong> If you had a quality win (deemed as more than 10 points or a win on the road) you get <strong>2</strong> points</li>
                    <li><strong>Who did you beat (part 1)?</strong> If you beat a team from a power 4 conference you get <strong>1</strong> point</li>
                    <li><strong>Who did you beat (part 2)?</strong> If you beat a team who is <strong>currently (updated weekly)</strong> in the top 30 of total points you get <strong>3</strong> points; A team in the top 60 gets <strong>2</strong> points; And a team in the top 100 gets <strong>1</strong> point </li>

                </ul>
                
                <h3>Point System</h3>
                <p>Teams accumulate points each week based on if they win, how they won, and who they beat. The total points system provides a cumulative view of the entire season, while weekly details show how teams performed in specific weeks.</p>
                
                <h3>Updates</h3>
                <p>Standings are updated weekly after all games are completed and verified.</p>
                <p>Ultimately, the standings won't truly reflect the winner until the final week.</p>
            </div>
        </div>

        <!-- Total Points Page -->
        <div id="total-points" class="page">
            <div class="container">
                <h2>Total Points Standings</h2>
                <div id="totalMessageArea"></div>
                <div id="totalTableSection">
                    <div id="totalTableInfo" class="table-info"></div>
                    <div id="totalTableContainer"></div>
                </div>
            </div>
        </div>

        <!-- 2024 Standing Comparison Page -->
        <div id="2024-comparison" class="page">
            <div class="container">
                <h2>2024 Standing Comparison</h2>
                <p>Compare the current merit-based standings with traditional 2024 rankings and polls.</p>
                <p>Strength of schedule reflects the team's standing from the week prior</p>
                <div id="comparisonMessageArea"></div>
                <div id="comparisonTableSection">
                    <div id="comparisonTableInfo" class="table-info"></div>
                    <div id="comparisonTableContainer"></div>
                </div>
            </div>
        </div>

        <!-- All Games Page -->
        <div id="all-games" class="page">
            <div class="container">
            <h2>All Game Data</h2>
            <p>See all the game data in this master table. Sort and filter to see specific teams or games by week</p>
            
            <!-- Filter Controls -->
            <div class="filter-controls">
                <div class="filter-row">
                    <div class="filter-group">
                        <label for="teamFilter">Filter by Team 1:</label>
                        <input type="text" id="teamFilter" placeholder="Enter team name..." onkeyup="filterAllGamesData()">
                    </div>
                    <div class="filter-group">
                        <label for="weekFilter">Filter by Week:</label>
                        <select id="weekFilter" onchange="filterAllGamesData()">
                            <option value="">All Weeks</option>
                            <option value="1">Week 1</option>
                            <option value="2">Week 2</option>
                            <option value="3">Week 3</option>
                            <option value="4">Week 4</option>
                            <option value="5">Week 5</option>
                            <option value="6">Week 6</option>
                            <option value="7">Week 7</option>
                            <option value="8">Week 8</option>
                            <option value="9">Week 9</option>
                            <option value="10">Week 10</option>
                            <option value="11">Week 11</option>
                            <option value="12">Week 12</option>
                            <option value="13">Week 13</option>
                            <option value="14">Week 14</option>
                            <option value="15">Week 15</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <button onclick="clearAllGamesFilter()" class="clear-filter-btn">Clear Filters</button>
                    </div>
                </div>
            </div>
        
        <div id="allgamesMessageArea"></div>
        <div id="allgamesTableSection">
            <div id="allgamesTableInfo" class="table-info"></div>
            <div id="allgamesTableContainer"></div>
        </div>
    </div>
</div>

        <!-- Week Pages -->
        <div id="week-1" class="page">
            <div class="container">
                <h2>Week 1 Details</h2>
                <p>Week 1 performance breakdown after the first week of competition.</p>
                <p>Strength of schedule reflects the team's standing from the week prior</p>
                <div id="week1MessageArea"></div>
                <div id="week1TableSection">
                    <div id="week1TableInfo" class="table-info"></div>
                    <div id="week1TableContainer"></div>
                </div>
            </div>
        </div>

        <div id="week-2" class="page">
            <div class="container">
                <h2>Week 2 Details</h2>
                <p>Week 2 performance breakdown after the first week of competition.</p>
                <p>Strength of schedule reflects the team's standing from the week prior</p>
                <div id="week2MessageArea"></div>
                <div id="week2TableSection">
                    <div id="week2TableInfo" class="table-info"></div>
                    <div id="week2TableContainer"></div>
                </div>
            </div>
        </div>

        <div id="week-3" class="page">
            <div class="container">
                <h2>Week 3 Details</h2>
                <p>Week 3 performance breakdown after the first week of competition.</p>
                <p>Strength of schedule reflects the team's standing from the week prior</p>
                <div id="week3MessageArea"></div>
                <div id="week3TableSection">
                    <div id="week3TableInfo" class="table-info"></div>
                    <div id="week3TableContainer"></div>
                </div>
            </div>
        </div>

        <div id="week-4" class="page">
            <div class="container">
                <h2>Week 4 Details</h2>
                <p>Week 4 performance breakdown after the first week of competition.</p>
                <p>Strength of schedule reflects the team's standing from the week prior</p>
                <div id="week4MessageArea"></div>
                <div id="week4TableSection">
                    <div id="week4TableInfo" class="table-info"></div>
                    <div id="week4TableContainer"></div>
                </div>
            </div>
        </div>

        <div id="week-5" class="page">
            <div class="container">
                <h2>Week 5 Details</h2>
                <p>Week 5 performance breakdown and standings.</p>
                <div id="week5-content">
                    <div class="no-data">
                        <p>Week 5 data will be displayed here when available.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="week-6" class="page">
            <div class="container">
                <h2>Week 6 Details</h2>
                <p>Week 6 performance breakdown and standings.</p>
                <div id="week6-content">
                    <div class="no-data">
                        <p>Week 6 data will be displayed here when available.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="week-7" class="page">
            <div class="container">
                <h2>Week 7 Details</h2>
                <p>Week 7 performance breakdown and standings.</p>
                <div id="week7-content">
                    <div class="no-data">
                        <p>Week 7 data will be displayed here when available.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="week-8" class="page">
            <div class="container">
                <h2>Week 8 Details</h2>
                <p>Week 8 performance breakdown and standings.</p>
                <div id="week8-content">
                    <div class="no-data">
                        <p>Week 8 data will be displayed here when available.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="week-9" class="page">
            <div class="container">
                <h2>Week 9 Details</h2>
                <p>Week 9 performance breakdown and standings.</p>
                <div id="week9-content">
                    <div class="no-data">
                        <p>Week 9 data will be displayed here when available.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="week-10" class="page">
            <div class="container">
                <h2>Week 10 Details</h2>
                <p>Week 10 performance breakdown and standings.</p>
                <div id="week10-content">
                    <div class="no-data">
                        <p>Week 10 data will be displayed here when available.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="week-11" class="page">
            <div class="container">
                <h2>Week 11 Details</h2>
                <p>Week 11 performance breakdown and standings.</p>
                <div id="week11-content">
                    <div class="no-data">
                        <p>Week 11 data will be displayed here when available.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="week-12" class="page">
            <div class="container">
                <h2>Week 12 Details</h2>
                <p>Week 12 performance breakdown and standings.</p>
                <div id="week12-content">
                    <div class="no-data">
                        <p>Week 12 data will be displayed here when available.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="week-13" class="page">
            <div class="container">
                <h2>Week 13 Details</h2>
                <p>Week 13 performance breakdown and standings.</p>
                <div id="week13-content">
                    <div class="no-data">
                        <p>Week 13 data will be displayed here when available.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="week-14" class="page">
            <div class="container">
                <h2>Week 14 Details</h2>
                <p>Week 14 performance breakdown and standings.</p>
                <div id="week14-content">
                    <div class="no-data">
                        <p>Week 14 data will be displayed here when available.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="week-15" class="page">
            <div class="container">
                <h2>Week 15 Details</h2>
                <p>Week 15 performance breakdown and standings.</p>
                <div id="week15-content">
                    <div class="no-data">
                        <p>Week 15 data will be displayed here when available.</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Global variables for current standings
        let currentStandingsData = [];
        let currentStandingsHeaders = [];
        let currentSortColumn = null;
        let currentSortDirection = 'asc';

        // Global variables for previous standings (add near the top with other variables)
        let previousStandingsData = [];
        let previousStandingsHeaders = [];
        let previousSortColumn = null;
        let previousSortDirection = 'asc';

        // Global variables for total points
        let totalPointsData = [];
        let totalPointsHeaders = [];
        let totalSortColumn = null;
        let totalSortDirection = 'asc';

        // Global variables for 2024 comparison
        let comparisonData = [];
        let comparisonHeaders = [];
        let comparisonSortColumn = null;
        let comparisonSortDirection = 'asc';
        let highlightedTeam = null;

         // Global variables for All games data
        let allgameData = [];
        let allgameHeaders = [];
        let allgameSortColumn = null;
        let allgameSortDirection = 'asc';
        let originalAllGameData = []; // Store original unfiltered data

        // Global variables for week data
        let weekDataCache = {};
        let weekHeaders = {};
        let weekSortColumns = {};
        let weekSortDirections = {};

        // Handle mobile dropdown behavior
        document.addEventListener('DOMContentLoaded', function() {
            const dropdowns = document.querySelectorAll('.dropdown');
            
            dropdowns.forEach(dropdown => {
                const dropdownToggle = dropdown.querySelector('.nav-item');
                const dropdownContent = dropdown.querySelector('.dropdown-content');
                
                // Toggle dropdown on click
                dropdownToggle.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    // Close all other dropdowns first
                    dropdowns.forEach(otherDropdown => {
                        if (otherDropdown !== dropdown) {
                            otherDropdown.classList.remove('active');
                        }
                    });
                    
                    // Toggle current dropdown
                    dropdown.classList.toggle('active');
                });
                
                // Close dropdown when clicking on dropdown items
                const dropdownItems = dropdown.querySelectorAll('.dropdown-item');
                dropdownItems.forEach(item => {
                    item.addEventListener('click', function() {
                        dropdown.classList.remove('active');
                    });
                });
            });
            
            // Close dropdowns when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.dropdown')) {
                    dropdowns.forEach(dropdown => {
                        dropdown.classList.remove('active');
                    });
                }
            });
        });

        // Page navigation
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Remove active class from nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Add active class to corresponding nav item and load data
            if (pageId === 'current-standings') {
                const standingsDropdown = document.querySelector('.dropdown .nav-item');
                if (standingsDropdown && standingsDropdown.classList) {
                    standingsDropdown.classList.add('active');
                }
                loadCurrentStandingsData();
            } else if (pageId === 'previous-standings') {
                const standingsDropdown = document.querySelector('.dropdown .nav-item');
                if (standingsDropdown && standingsDropdown.classList) {
                    standingsDropdown.classList.add('active');
                }
                loadPreviousStandingsData();
            } else if (pageId === 'about') {
                const aboutNav = document.querySelector('.nav-item[href="#about"]');
                if (aboutNav) aboutNav.classList.add('active');
            } else if (pageId === 'total-points') {
                document.querySelector('.nav-item[href="#total-points"]').classList.add('active');
                loadTotalPointsData();
            } else if (pageId === '2024-comparison') {
                document.querySelector('.nav-item[href="#2024-comparison"]').classList.add('active');
                load2024ComparisonData();
            } else if (pageId === 'all-games') {
                document.querySelector('.nav-item[href="#all-games"]').classList.add('active');
                loadAllGamesData();
            } else if (pageId.startsWith('week-')) {
                const weekNumber = parseInt(pageId.split('-')[1]);
                loadWeekData(weekNumber);
            }
            
            // Update page title
            if (pageId === 'current-standings') {
                document.title = 'Current Standings - College Football Merit Based Standings';
            } else if (pageId === 'about') {
                document.title = 'About the Standings - College Football Merit Based Standings';
            } else if (pageId === 'total-points') {
                document.title = 'Total Points - College Football Merit Based Standings';
            } else if (pageId === '2024-comparison') {
                document.title = '2024 Standing Comparison - College Football Merit Based Standings';
            } else if (pageId === 'all-games') {
                document.title = 'All Game Data - College Football Merit Based Standings';
            } else if (pageId.startsWith('week-')) {
                const weekNum = pageId.split('-')[1];
                document.title = `Week ${weekNum} - College Football Merit Based Standings`;
            }
        }

        // Load current standings data
        function loadCurrentStandingsData() {
            const messageArea = document.getElementById('currentMessageArea');
            showMessage('Loading current standings...', 'loading', messageArea);
            
            fetch('/api/current-standings')
                .then(response => response.json())
                .then(data => {
                    messageArea.innerHTML = '';
                    
                    if (data.headers.length === 0 || data.data.length === 0) {
                        showNoData('currentTableContainer', 'currentTableInfo', 'current-standings.csv');
                    } else {
                        currentStandingsHeaders = data.headers;
                        currentStandingsData = [...data.data];
                        displayCurrentStandingsTable(currentStandingsHeaders, currentStandingsData);
                    }
                })
                .catch(error => {
                    showMessage('Error loading current standings: ' + error.message, 'error', messageArea);
                });
        }

        // Load previous standings data
        function loadPreviousStandingsData() {
            const messageArea = document.getElementById('previousMessageArea');
            showMessage('Loading previous standings...', 'loading', messageArea);
    
            fetch('/api/previous-standings')
                .then(response => response.json())
        .then(data => {
            messageArea.innerHTML = '';
            
            if (data.headers.length === 0 || data.data.length === 0) {
                showNoData('previousTableContainer', 'previousTableInfo', 'previous-standings.csv');
            } else {
                previousStandingsHeaders = data.headers;
                previousStandingsData = [...data.data];
                displayPreviousStandingsTable(previousStandingsHeaders, previousStandingsData);
            }
        })
        .catch(error => {
            showMessage('Error loading previous standings: ' + error.message, 'error', messageArea);
        });
}
        // Load total points data
        function loadTotalPointsData() {
            const messageArea = document.getElementById('totalMessageArea');
            showMessage('Loading total points...', 'loading', messageArea);
            
            fetch('/api/total-points')
                .then(response => response.json())
                .then(data => {
                    messageArea.innerHTML = '';
                    
                    if (data.headers.length === 0 || data.data.length === 0) {
                        showNoData('totalTableContainer', 'totalTableInfo', 'total-points.csv');
                    } else {
                        totalPointsHeaders = data.headers;
                        totalPointsData = [...data.data];
                        displayTotalPointsTable(totalPointsHeaders, totalPointsData);
                    }
                })
                .catch(error => {
                    showMessage('Error loading total points: ' + error.message, 'error', messageArea);
                });
        }

        // Sort data by column (Current Standings)
        function sortCurrentStandingsData(columnIndex, direction) {
            const column = currentStandingsHeaders[columnIndex];
            
            currentStandingsData.sort((a, b) => {
                let valueA = a[column] || '';
                let valueB = b[column] || '';
                
                const numA = parseFloat(valueA);
                const numB = parseFloat(valueB);
                
                if (!isNaN(numA) && !isNaN(numB)) {
                    return direction === 'asc' ? numA - numB : numB - numA;
                } else {
                    valueA = valueA.toString().toLowerCase();
                    valueB = valueB.toString().toLowerCase();
                    
                    if (direction === 'asc') {
                        return valueA.localeCompare(valueB);
                    } else {
                        return valueB.localeCompare(valueA);
                    }
                }
            });
        }

        // Sort data by column (Previous Standings)
        function sortPreviousStandingsData(columnIndex, direction) {
            const column = previousStandingsHeaders[columnIndex];
            
            previousStandingsData.sort((a, b) => {
                let valueA = a[column] || '';
                let valueB = b[column] || '';
                
                const numA = parseFloat(valueA);
                const numB = parseFloat(valueB);
                
                if (!isNaN(numA) && !isNaN(numB)) {
                    return direction === 'asc' ? numA - numB : numB - numA;
                } else {
                    valueA = valueA.toString().toLowerCase();
                    valueB = valueB.toString().toLowerCase();
                    
                    if (direction === 'asc') {
                        return valueA.localeCompare(valueB);
                    } else {
                        return valueB.localeCompare(valueA);
                    }
                }
            });
        }


        // Sort data by column (Total Points)
        function sortTotalPointsData(columnIndex, direction) {
            const column = totalPointsHeaders[columnIndex];
            
            totalPointsData.sort((a, b) => {
                let valueA = a[column] || '';
                let valueB = b[column] || '';
                
                const numA = parseFloat(valueA);
                const numB = parseFloat(valueB);
                
                if (!isNaN(numA) && !isNaN(numB)) {
                    return direction === 'asc' ? numA - numB : numB - numA;
                } else {
                    valueA = valueA.toString().toLowerCase();
                    valueB = valueB.toString().toLowerCase();
                    
                    if (direction === 'asc') {
                        return valueA.localeCompare(valueB);
                    } else {
                        return valueB.localeCompare(valueA);
                    }
                }
            });
        }

        // Handle header click for sorting (Current Standings)
        function handleCurrentStandingsHeaderClick(columnIndex) {
            if (currentSortColumn === columnIndex) {
                currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                currentSortDirection = 'asc';
            }
            
            currentSortColumn = columnIndex;
            sortCurrentStandingsData(columnIndex, currentSortDirection);
            displayCurrentStandingsTable(currentStandingsHeaders, currentStandingsData);
        }

        // Handle header click for sorting (Previous Standings)
        function handlePreviousStandingsHeaderClick(columnIndex) {
            if (previousSortColumn === columnIndex) {
                previousSortDirection = previousSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                previousSortDirection = 'asc';
            }
            
            previousSortColumn = columnIndex;
            sortPreviousStandingsData(columnIndex, previousSortDirection);
            displayPreviousStandingsTable(previousStandingsHeaders, previousStandingsData);
        }

        // Handle header click for sorting (Total Points)
        function handleTotalPointsHeaderClick(columnIndex) {
            if (totalSortColumn === columnIndex) {
                totalSortDirection = totalSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                totalSortDirection = 'asc';
            }
            
            totalSortColumn = columnIndex;
            sortTotalPointsData(columnIndex, totalSortDirection);
            displayTotalPointsTable(totalPointsHeaders, totalPointsData);
        }

        // Display current standings table
        function displayCurrentStandingsTable(headers, data) {
            const tableInfo = document.getElementById('currentTableInfo');
            const tableContainer = document.getElementById('currentTableContainer');
            
            tableInfo.innerHTML = `Showing ${data.length} rows × ${headers.length} columns`;

            let html = '<table><thead><tr>';
            headers.forEach((header, index) => {
                let headerClass = 'sortable';
                if (currentSortColumn === index) {
                    headerClass += currentSortDirection === 'asc' ? ' sort-asc' : ' sort-desc';
                }
                html += `<th class="${headerClass}" onclick="handleCurrentStandingsHeaderClick(${index})" title="Click to sort by ${header}">${header}</th>`;
            });
            html += '</tr></thead><tbody>';

            data.forEach(row => {
                html += '<tr>';
                headers.forEach((header, index) => {
                    const cellValue = row[header] || '';
                    
                    // Only make the second column (index 1) clickable as team names
                    if (index === 1 && cellValue) {
                        // Make team names clickable links
                        html += `<td><a class="team-link" href="#all-games?team=${encodeURIComponent(cellValue)}">${cellValue}</a></td>`;
                    } else {
                        html += `<td>${cellValue}</td>`;
                    }
                });
                html += '</tr>';
            });

            html += '</tbody></table>';
            tableContainer.innerHTML = html;
        }


        // Display previous standings table
        function displayPreviousStandingsTable(headers, data) {
            const tableInfo = document.getElementById('previousTableInfo');
            const tableContainer = document.getElementById('previousTableContainer');
            
            tableInfo.innerHTML = `Showing ${data.length} rows × ${headers.length} columns`;

            let html = '<table><thead><tr>';
            headers.forEach((header, index) => {
                let headerClass = 'sortable';
                if (previousSortColumn === index) {
                    headerClass += previousSortDirection === 'asc' ? ' sort-asc' : ' sort-desc';
                }
                html += `<th class="${headerClass}" onclick="handlePreviousStandingsHeaderClick(${index})" title="Click to sort by ${header}">${header}</th>`;
            });
            html += '</tr></thead><tbody>';

            data.forEach(row => {
                html += '<tr>';
                headers.forEach(header => {
                    html += `<td>${row[header] || ''}</td>`;
                });
                html += '</tr>';
            });

            html += '</tbody></table>';
            tableContainer.innerHTML = html;
        }

        // Display total points table
        function displayTotalPointsTable(headers, data) {
            const tableInfo = document.getElementById('totalTableInfo');
            const tableContainer = document.getElementById('totalTableContainer');
            
            tableInfo.innerHTML = `Showing ${data.length} rows × ${headers.length} columns`;

            let html = '<table><thead><tr>';
            headers.forEach((header, index) => {
                let headerClass = 'sortable';
                if (totalSortColumn === index) {
                    headerClass += totalSortDirection === 'asc' ? ' sort-asc' : ' sort-desc';
                }
                html += `<th class="${headerClass}" onclick="handleTotalPointsHeaderClick(${index})" title="Click to sort by ${header}">${header}</th>`;
            });
            html += '</tr></thead><tbody>';

            data.forEach(row => {
                html += '<tr>';
                headers.forEach(header => {
                    html += `<td>${row[header] || ''}</td>`;
                });
                html += '</tr>';
            });

            html += '</tbody></table>';
            tableContainer.innerHTML = html;
        }

        // Show no data message
        function showNoData(containerId, infoId, filename) {
            const tableInfo = document.getElementById(infoId);
            const tableContainer = document.getElementById(containerId);
            
            tableInfo.innerHTML = '';
            tableContainer.innerHTML = `
                <div class="no-data">
                    <h3>No Data Available</h3>
                    <p>Please add your <strong>${filename}</strong> file in the project root directory and restart the server.</p>
                </div>
            `;
        }

        // Show messages
        function showMessage(message, type, messageArea) {
            messageArea.innerHTML = `<div class="message ${type}">${message}</div>`;
        }

        // Load 2024 comparison data
        function load2024ComparisonData() {
            const messageArea = document.getElementById('comparisonMessageArea');
            showMessage('Loading 2024 comparison data...', 'loading', messageArea);
            
            fetch('/api/2024-comparison')
                .then(response => response.json())
                .then(data => {
                    messageArea.innerHTML = '';
                    
                    if (data.headers.length === 0 || data.data.length === 0) {
                        showNoData('comparisonTableContainer', 'comparisonTableInfo', '2024-comparison.csv');
                    } else {
                        comparisonHeaders = data.headers;
                        comparisonData = [...data.data];
                        display2024ComparisonTable(comparisonHeaders, comparisonData);
                    }
                })
                .catch(error => {
                    showMessage('Error loading 2024 comparison data: ' + error.message, 'error', messageArea);
                });
        }

        // Sort 2024 comparison data by column
        function sort2024ComparisonData(columnIndex, direction) {
            const column = comparisonHeaders[columnIndex];
            
            comparisonData.sort((a, b) => {
                let valueA = a[column] || '';
                let valueB = b[column] || '';
                
                const numA = parseFloat(valueA);
                const numB = parseFloat(valueB);
                
                if (!isNaN(numA) && !isNaN(numB)) {
                    return direction === 'asc' ? numA - numB : numB - numA;
                } else {
                    valueA = valueA.toString().toLowerCase();
                    valueB = valueB.toString().toLowerCase();
                    
                    if (direction === 'asc') {
                        return valueA.localeCompare(valueB);
                    } else {
                        return valueB.localeCompare(valueA);
                    }
                }
            });
        }

        // Handle header click for sorting (2024 Comparison)
        function handle2024ComparisonHeaderClick(columnIndex) {
            if (comparisonSortColumn === columnIndex) {
                comparisonSortDirection = comparisonSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                comparisonSortDirection = 'asc';
            }
            
            comparisonSortColumn = columnIndex;
            sort2024ComparisonData(columnIndex, comparisonSortDirection);
            display2024ComparisonTable(comparisonHeaders, comparisonData);
        }

        // Load all games data
        function loadAllGamesData() {
        const messageArea = document.getElementById('allgamesMessageArea');
        showMessage('Loading All Games data...', 'loading', messageArea);

        fetch('/api/all-games')
            .then(response => response.json())
            .then(data => {
            messageArea.innerHTML = '';

            if (data.headers.length === 0 || data.data.length === 0) {
                showNoData('allgamesTableContainer', 'allgamesTableInfo', 'all-games.csv');
            } else {
                allgameHeaders = data.headers;
                allgameData = [...data.data];
                originalAllGameData = [...data.data]; // Store original data
                displayAllGamesTable(allgameHeaders, allgameData);

                // <<< ADD THIS BLOCK >>>
                const hash = location.hash || '';
                if (hash.startsWith('#all-games')) {
                const qs = hash.split('?')[1] || '';
                const params = new URLSearchParams(qs);
                const team = params.get('team') || '';
                const week = params.get('week') || '';

                const tf = document.getElementById('teamFilter');
                const wf = document.getElementById('weekFilter');

                if (tf && team) tf.value = team;
                if (wf && week) wf.value = week;

                if ((team || week) && typeof filterAllGamesData === 'function') {
                    filterAllGamesData();
                }
                }
                // <<< END ADD >>>
            }
            })
            .catch(error => {
            showMessage('Error loading All Games data: ' + error.message, 'error', messageArea);
            });
        }


        // Sort All Games data by column
        function sortAllGamesData(columnIndex, direction) {
            const column = allgameHeaders[columnIndex];
            
            allgameData.sort((a, b) => {
                let valueA = a[column] || '';
                let valueB = b[column] || '';
                
                const numA = parseFloat(valueA);
                const numB = parseFloat(valueB);
                
                if (!isNaN(numA) && !isNaN(numB)) {
                    return direction === 'asc' ? numA - numB : numB - numA;
                } else {
                    valueA = valueA.toString().toLowerCase();
                    valueB = valueB.toString().toLowerCase();
                    
                    if (direction === 'asc') {
                        return valueA.localeCompare(valueB);
                    } else {
                        return valueB.localeCompare(valueA);
                    }
                }
            });
        }

        // Handle header click for sorting (All Games)
        function handleAllGamesHeaderClick(columnIndex) {
            if (allgameSortColumn === columnIndex) {
                allgameSortDirection = allgameSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                allgameSortDirection = 'asc';
            }
            
            allgameSortColumn = columnIndex;
            sortAllGamesData(columnIndex, allgameSortDirection);
            displayAllGamesTable(allgameHeaders, allgameData);
        }

        // Handle team cell click for highlighting
        function handleTeamCellClick(teamName, event) {
            event.stopPropagation();
            console.log('Cell clicked:', teamName); // Debug log
            
            // Clear previous highlights
            document.querySelectorAll('.highlighted-team').forEach(cell => {
                cell.classList.remove('highlighted-team');
                console.log('Removed highlight from:', cell.textContent); // Debug log
            });
            
            if (highlightedTeam === teamName) {
                // If clicking the same team, unhighlight
                highlightedTeam = null;
                console.log('Unhighlighted team:', teamName); // Debug log
            } else {
                // Highlight all cells with matching team name
                highlightedTeam = teamName;
                console.log('Highlighting team:', teamName); // Debug log
                highlightTeamCells(teamName);
            }
        }

        // Highlight all cells containing the specified team name
        function highlightTeamCells(teamName) {
            if (!teamName) return;
            
            const cells = document.querySelectorAll('#comparisonTableContainer td');
            console.log('Found cells to check:', cells.length); // Debug log
            
            let highlightCount = 0;
            cells.forEach(cell => {
                const cellText = cell.textContent.trim();
                // Check for exact match or if team name is contained in the cell
                if (cellText === teamName || cellText.toLowerCase().includes(teamName.toLowerCase())) {
                    cell.classList.add('highlighted-team');
                    highlightCount++;
                    console.log('Highlighted cell:', cellText); // Debug log
                }
            });
            
            console.log('Total cells highlighted:', highlightCount); // Debug log
        }
        function display2024ComparisonTable(headers, data) {
            const tableInfo = document.getElementById('comparisonTableInfo');
            const tableContainer = document.getElementById('comparisonTableContainer');
            
            tableInfo.innerHTML = `Showing ${data.length} rows × ${headers.length} columns`;

            let html = '<table><thead><tr>';
            headers.forEach((header, index) => {
                let headerClass = 'sortable';
                if (comparisonSortColumn === index) {
                    headerClass += comparisonSortDirection === 'asc' ? ' sort-asc' : ' sort-desc';
                }
                html += `<th class="${headerClass}" onclick="handle2024ComparisonHeaderClick(${index})" title="Click to sort by ${header}">${header}</th>`;
            });
            html += '</tr></thead><tbody>';

            data.forEach(row => {
                html += '<tr>';
                headers.forEach(header => {
                    html += `<td>${row[header] || ''}</td>`;
                });
                html += '</tr>';
            });

            html += '</tbody></table>';
            tableContainer.innerHTML = html;
        }

        // Filter function for All Games data
        function filterAllGamesData() {
            const teamFilter = document.getElementById('teamFilter').value.trim();
            const weekFilter = document.getElementById('weekFilter').value;

            let filteredData = [...originalAllGameData];

            // ---- Team 1 filter only (case-insensitive) ----
            if (teamFilter) {
                const needle = teamFilter.toLowerCase();

                const team1Column = allgameHeaders.find(h =>
                /team\s*1/i.test(String(h))
                );

                if (team1Column) {
                filteredData = filteredData.filter(row =>
                    (row[team1Column] || '').toString().trim().toLowerCase() === needle
                );
                }
            }

            // ---- Week filter (unchanged) ----
            if (weekFilter) {
                filteredData = filteredData.filter(row => {
                const weekColumn = allgameHeaders.find(header =>
                    String(header).toLowerCase().includes('week')
                );
                if (weekColumn) {
                    const weekValue = (row[weekColumn] || '').toString();
                    return weekValue === weekFilter;
                }
                return true;
                });
            }

            // Update table
            allgameData = filteredData;
            displayAllGamesTable(allgameHeaders, allgameData);

            // Update info
            const tableInfo = document.getElementById('allgamesTableInfo');
            const totalRows = originalAllGameData.length;
            const filteredRows = filteredData.length;

            if (teamFilter || weekFilter) {
                tableInfo.innerHTML = `Showing ${filteredRows} of ${totalRows} rows × ${allgameHeaders.length} columns (filtered)`;
            } else {
                tableInfo.innerHTML = `Showing ${filteredRows} rows × ${allgameHeaders.length} columns`;
            }
            }

        // Clear all filters
        function clearAllGamesFilter() {
            document.getElementById('teamFilter').value = '';
            document.getElementById('weekFilter').value = '';
            
            // Reset to original data
            allgameData = [...originalAllGameData];
            displayAllGamesTable(allgameHeaders, allgameData);
            
            // Update table info
            const tableInfo = document.getElementById('allgamesTableInfo');
            tableInfo.innerHTML = `Showing ${allgameData.length} rows × ${allgameHeaders.length} columns`;
        }

        function displayAllGamesTable(headers, data) {
            const tableInfo = document.getElementById('allgamesTableInfo');
            const tableContainer = document.getElementById('allgamesTableContainer');
            
            tableInfo.innerHTML = `Showing ${data.length} rows × ${headers.length} columns`;

            let html = '<table><thead><tr>';
            headers.forEach((header, index) => {
                let headerClass = 'sortable';
                if (allgameSortColumn === index) {
                    headerClass += allgameSortDirection === 'asc' ? ' sort-asc' : ' sort-desc';
                }
                html += `<th class="${headerClass}" onclick="handleAllGamesHeaderClick(${index})" title="Click to sort by ${header}">${header}</th>`;
            });
            html += '</tr></thead><tbody>';

            data.forEach(row => {
                html += '<tr>';
                headers.forEach(header => {
                    html += `<td>${row[header] || ''}</td>`;
                });
                html += '</tr>';
            });

            html += '</tbody></table>';
            tableContainer.innerHTML = html;
        }

        function loadWeekData(weekNumber) {
            const messageArea = document.getElementById(`week${weekNumber}MessageArea`);
            showMessage(`Loading week ${weekNumber} data...`, 'loading', messageArea);
            
            fetch(`/api/week/${weekNumber}`)
                .then(response => response.json())
                .then(data => {
                    messageArea.innerHTML = '';
                    
                    if (data.headers.length === 0 || data.data.length === 0) {
                        showNoData(`week${weekNumber}TableContainer`, `week${weekNumber}TableInfo`, `week-${weekNumber}.csv`);
                    } else {
                        weekHeaders[weekNumber] = data.headers;
                        weekDataCache[weekNumber] = [...data.data];
                        weekSortColumns[weekNumber] = null;
                        weekSortDirections[weekNumber] = 'asc';
                        displayWeekTable(weekNumber, weekHeaders[weekNumber], weekDataCache[weekNumber]);
                    }
                })
                .catch(error => {
                    showMessage(`Error loading week ${weekNumber} data: ` + error.message, 'error', messageArea);
                });
        }

        // Sort week data by column
        function sortWeekData(weekNumber, columnIndex, direction) {
            const column = weekHeaders[weekNumber][columnIndex];
            
            weekDataCache[weekNumber].sort((a, b) => {
                let valueA = a[column] || '';
                let valueB = b[column] || '';
                
                const numA = parseFloat(valueA);
                const numB = parseFloat(valueB);
                
                if (!isNaN(numA) && !isNaN(numB)) {
                    return direction === 'asc' ? numA - numB : numB - numA;
                } else {
                    valueA = valueA.toString().toLowerCase();
                    valueB = valueB.toString().toLowerCase();
                    
                    if (direction === 'asc') {
                        return valueA.localeCompare(valueB);
                    } else {
                        return valueB.localeCompare(valueA);
                    }
                }
            });
        }

        // Handle header click for sorting (Week data)
        function handleWeekHeaderClick(weekNumber, columnIndex) {
            if (weekSortColumns[weekNumber] === columnIndex) {
                weekSortDirections[weekNumber] = weekSortDirections[weekNumber] === 'asc' ? 'desc' : 'asc';
            } else {
                weekSortDirections[weekNumber] = 'asc';
            }
            
            weekSortColumns[weekNumber] = columnIndex;
            sortWeekData(weekNumber, columnIndex, weekSortDirections[weekNumber]);
            displayWeekTable(weekNumber, weekHeaders[weekNumber], weekDataCache[weekNumber]);
        }

        // Display week table
        function displayWeekTable(weekNumber, headers, data) {
            const tableInfo = document.getElementById(`week${weekNumber}TableInfo`);
            const tableContainer = document.getElementById(`week${weekNumber}TableContainer`);
            
            tableInfo.innerHTML = `Showing ${data.length} rows × ${headers.length} columns`;

            let html = '<table><thead><tr>';
            headers.forEach((header, index) => {
                let headerClass = 'sortable';
                if (weekSortColumns[weekNumber] === index) {
                    headerClass += weekSortDirections[weekNumber] === 'asc' ? ' sort-asc' : ' sort-desc';
                }
                html += `<th class="${headerClass}" onclick="handleWeekHeaderClick(${weekNumber}, ${index})" title="Click to sort by ${header}">${header}</th>`;
            });
            html += '</tr></thead><tbody>';

            data.forEach(row => {
                html += '<tr>';
                headers.forEach(header => {
                    html += `<td>${row[header] || ''}</td>`;
                });
                html += '</tr>';
            });

            html += '</tbody></table>';
            tableContainer.innerHTML = html;
        }

        // --- Simple hash router ---
        function applyRoute() {
            const raw = location.hash.slice(1) || 'current-standings';
            const [pageId, qs] = raw.split('?');
            showPage(pageId);

            const params = new URLSearchParams(qs || '');

            if (pageId === 'all-games') {
                const team = params.get('team') || '';
                const week = params.get('week') || '';

                // Wait until inputs + data are available, then apply the filter once
                const ready = () =>
                document.getElementById('teamFilter') &&
                document.getElementById('weekFilter') &&
                Array.isArray(window.originalAllGameData) &&
                originalAllGameData.length &&
                Array.isArray(window.allgameHeaders) &&
                allgameHeaders.length;

                (function tryApply(attempts = 40) {
                if (!ready()) return attempts ? setTimeout(() => tryApply(attempts - 1), 50) : null;

                const tf = document.getElementById('teamFilter');
                const wf = document.getElementById('weekFilter');
                if (team) tf.value = team;
                if (week) wf.value = week;

                if (typeof filterAllGamesData === 'function') filterAllGamesData();
                })();
            }
        }


        window.addEventListener('hashchange', applyRoute);
        window.addEventListener('load', applyRoute);

    </script>
</body>
</html>